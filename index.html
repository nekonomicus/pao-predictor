<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PAO → Risk of Conversion to Total Hip Arthroplasty Following Periacetabular Osteotomy (PAO) for hip Dysplasia</title>

  <style>
    :root{
      --bg0:#060a14;
      --bg1:#0b1630;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --muted2:rgba(255,255,255,.50);
      --accent:#38bdf8;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --r:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(56,189,248,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.18), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
      padding:48px 18px;
    }

    .wrap{max-width:980px;margin:0 auto}
    .header{
      display:flex; flex-direction:column; gap:10px;
      margin-bottom:22px;
    }
    .title{
      font-size:44px; line-height:1.05; font-weight:800;
      letter-spacing:-.02em;
    }
    .subtitle{
      color:var(--muted);
      font-size:15px;
      max-width:820px;
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      padding:22px;
      margin-top:18px;
      overflow:hidden;
    }

    .panel h2{
      margin:0 0 14px 0;
      font-size:28px;
      letter-spacing:-.01em;
    }

    /* ONE COLUMN INPUTS */
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:18px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    label{
      font-size:13px;
      color:var(--muted);
      letter-spacing:.01em;
    }

    input, select{
      width:100%;
      appearance:none;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      padding:14px 14px;
      border-radius:14px;
      outline:none;
      font-size:15px;
      transition: border-color .15s ease, transform .08s ease;
    }

    input:focus, select:focus{
      border-color: rgba(56,189,248,.65);
      box-shadow: 0 0 0 4px rgba(56,189,248,.14);
    }

    .hint{
      font-size:12px;
      color:var(--muted2);
      margin-top:-2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      width:fit-content;
    }

    .actions{
      margin-top:18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    button{
      border:1px solid rgba(56,189,248,.35);
      background: linear-gradient(180deg, rgba(56,189,248,.95), rgba(56,189,248,.70));
      color:#02121c;
      font-weight:800;
      padding:14px 16px;
      border-radius:16px;
      cursor:pointer;
      width:100%;
      font-size:15px;
      touch-action: manipulation; /* mobile-friendly */
    }
    button:hover{filter:brightness(1.03)}
    button:active{transform: translateY(1px)}

    .secondary{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
    }

    .results{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (min-width: 820px){
      .results{ grid-template-columns: 1fr 1fr; }
      button{ width:auto; min-width: 220px; }
      .actions{ justify-content:flex-start; }
    }

    .card{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      border-radius:18px;
      padding:18px;
      position:relative;
      overflow:hidden;
    }

    .card:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(500px 240px at 20% 0%, rgba(56,189,248,.10), transparent 55%),
                  radial-gradient(500px 240px at 80% 0%, rgba(34,197,94,.08), transparent 60%);
      pointer-events:none;
    }

    .card > *{ position:relative; }

    .kicker{
      color:var(--muted);
      font-size:13px;
      margin:0 0 8px 0;
    }
    .big{
      font-size:52px;
      font-weight:900;
      letter-spacing:-.02em;
      margin:0;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      padding:7px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      margin-top:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--muted);
    }
    .tag.low{ color: rgba(34,197,94,.95); border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .tag.mod{ color: rgba(245,158,11,.95); border-color: rgba(245,158,11,.25); background: rgba(245,158,11,.10); }
    .tag.high{ color: rgba(239,68,68,.95); border-color: rgba(239,68,68,.25); background: rgba(239,68,68,.10); }

    .details{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }

    .footer-note{
      margin-top:14px;
      font-size:12px;
      color:var(--muted2);
    }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="title">Risk of Conversion to Total Hip Arthroplasty Following Periacetabular Osteotomy (PAO) for hip Dysplasia</div>
      <div class="subtitle">
        Logistic regression–based risk estimation at <b>5</b> and <b>10</b> years (research tool; not a validated clinical decision aid).
        Obesity is defined as <b>BMI ≥ 30 kg/m²</b>.
      </div>
    </div>

    <div class="panel">
      <h2>Inputs</h2>

      <div class="grid">
        <div class="field">
          <label for="age">Age (years)</label>
          <input id="age" type="number" min="16" max="60" step="1" value="30" />
          <div class="hint">Continuous predictor in both models.</div>
        </div>

        <div class="field">
          <label for="tonnis">Tönnis grade</label>
          <select id="tonnis">
            <option value="0">0 – No OA</option>
            <option value="1">1 – Mild OA</option>
            <option value="2">2 – Moderate OA</option>
            <option value="3">3 – Severe OA</option>
          </select>
        </div>

        <div class="field">
          <label for="height">Height (cm)</label>
          <input id="height" type="number" min="120" max="220" step="0.1" value="170" />
          <div class="hint">Used to calculate BMI.</div>
        </div>

        <div class="field">
          <label for="weight">Weight (kg)</label>
          <input id="weight" type="number" min="30" max="200" step="0.1" value="60" />
          <div class="hint">Used to calculate BMI.</div>
        </div>

        <div class="field">
          <label>BMI (kg/m²)</label>
          <input id="bmi" type="text" readonly value="—" />
          <div class="hint">
            BMI is computed automatically from height and weight.
          </div>
          <div class="pill" id="obesityPill">Obesity (BMI ≥ 30): —</div>
        </div>

        <div class="field">
          <label for="ai13">Postoperative persistent hip dysplasia (acetabular index >13°)</label>
          <select id="ai13">
            <option value="0" selected>No</option>
            <option value="1">Yes</option>
          </select>
          <div class="hint">Used only in the 5-year model (binary).</div>
        </div>
      </div>

      <div class="actions">
        <button id="btnCalc" type="button">Calculate risk</button>
        <button class="secondary" id="btnReset" type="button">Reset</button>
      </div>
    </div>

    <div class="panel">
      <h2>Results</h2>

      <div class="results">
        <div class="card">
          <p class="kicker">Risk of THA ≤ 5 years</p>
          <p class="big" id="p5">—</p>
          <div class="tag" id="tag5">Not calculated</div>
          <div class="details" id="d5">
            Model (5y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βAI13·(AI≥13)</span>
          </div>
        </div>

        <div class="card">
          <p class="kicker">Risk of THA ≤ 10 years</p>
          <p class="big" id="p10">—</p>
          <div class="tag" id="tag10">Not calculated</div>
          <div class="details" id="d10">
            Model (10y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βObesity·(BMI≥30)</span>
          </div>
        </div>
      </div>

      <div class="footer-note">
        This risk calculation is based on research data from the Department of Orthopaedic Surgery at Inselspital, Bern, Switzerland, including long-term follow-up of patients treated with periacetabular osteotomy (PAO) for hip dysplasia. PAO was originally developed at this institution in 1984. Consequently, the underlying dataset includes heterogeneous cases spanning the early learning curve as well as contemporary surgical techniques, and represents one of the longest available follow-up periods worldwide. This model is only applicable to patients with developmental hip dysplasia treated with PAO. Risk estimation is not valid for other hip pathologies such as acetabular retroversion. 
No warranty is given regarding the accuracy, completeness, or applicability of the calculated results. The authors and the hosting institution accept no liability for clinical decisions, treatments, or outcomes based on the use of this tool. This page does not store or transmit data (runs locally in your browser).
      </div>
    </div>
  </div>

  <script>
    // === EDIT ONLY HERE IF COEFFICIENTS CHANGE ===
    const COEF = {
      y5:  { b0: -10.33325, bAge: 0.15787, bTonnis: 0.86506, bAI13: 2.09738 },
      y10: { b0:  -7.38452, bAge: 0.11155, bTonnis: 0.88387, bObesity: 1.21043 }
    };

    function clampNumber(x, min, max){
      if (Number.isNaN(x)) return min;
      return Math.max(min, Math.min(max, x));
    }

    function logistic(z){
      // numerically stable logistic
      if (z >= 0) {
        const ez = Math.exp(-z);
        return 1 / (1 + ez);
      } else {
        const ez = Math.exp(z);
        return ez / (1 + ez);
      }
    }

    function fmtPct(p){
      return (p*100).toFixed(2) + "%";
    }

    function riskTag(p){
      // simple thresholds for UI only (not clinical)
      if (p < 0.05) return { cls: "low",  txt: "Low risk" };
      if (p < 0.15) return { cls: "mod",  txt: "Moderate risk" };
      return            { cls: "high", txt: "Higher risk" };
    }

    function computeBmiFromHeightWeight(){
      const hCm = parseFloat(document.getElementById("height").value);
      const wKg = parseFloat(document.getElementById("weight").value);

      if (Number.isNaN(hCm) || Number.isNaN(wKg) || hCm <= 0 || wKg <= 0) {
        document.getElementById("bmi").value = "—";
        return NaN;
      }

      const hM = hCm / 100;
      const bmi = wKg / (hM * hM);

      document.getElementById("bmi").value = bmi.toFixed(1);
      return bmi;
    }

    function updateObesityPill(){
      const bmi = computeBmiFromHeightWeight();
      const obese = !Number.isNaN(bmi) && bmi >= 30;

      const pill = document.getElementById("obesityPill");
      pill.textContent = `Obesity (BMI ≥ 30): ${Number.isNaN(bmi) ? "—" : (obese ? "Yes" : "No")}`;
      pill.style.borderColor = obese ? "rgba(245,158,11,.30)" : "rgba(255,255,255,.14)";
      pill.style.background   = obese ? "rgba(245,158,11,.12)" : "rgba(255,255,255,.06)";
      pill.style.color        = obese ? "rgba(245,158,11,.95)" : "rgba(255,255,255,.65)";

      return obese ? 1 : 0;
    }

    function calculate(){
      const ageRaw = parseFloat(document.getElementById("age").value);
      const tonnisRaw = parseFloat(document.getElementById("tonnis").value);
      const ai13 = parseInt(document.getElementById("ai13").value, 10) || 0;

      const age = clampNumber(ageRaw, 16, 60);
      const tonnis = clampNumber(tonnisRaw, 0, 3);
      document.getElementById("age").value = age;

      const obesity = updateObesityPill();

      // 5y
      const z5 =
        COEF.y5.b0 +
        COEF.y5.bAge * age +
        COEF.y5.bTonnis * tonnis +
        COEF.y5.bAI13 * ai13;

      const p5 = logistic(z5);

      // 10y
      const z10 =
        COEF.y10.b0 +
        COEF.y10.bAge * age +
        COEF.y10.bTonnis * tonnis +
        COEF.y10.bObesity * obesity;

      const p10 = logistic(z10);

      // UI
      document.getElementById("p5").textContent = fmtPct(p5);
      document.getElementById("p10").textContent = fmtPct(p10);

      const t5 = riskTag(p5);
      const t10 = riskTag(p10);

      const tag5 = document.getElementById("tag5");
      tag5.className = "tag " + t5.cls;
      tag5.textContent = t5.txt;

      const tag10 = document.getElementById("tag10");
      tag10.className = "tag " + t10.cls;
      tag10.textContent = t10.txt;

      document.getElementById("d5").innerHTML =
        `Model (5y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βAI13·(AI≥13)</span><br>` +
        `<span class="mono">logit = ${z5.toFixed(4)} → p = ${fmtPct(p5)}</span>`;

      document.getElementById("d10").innerHTML =
        `Model (10y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βObesity·(BMI≥30)</span><br>` +
        `<span class="mono">logit = ${z10.toFixed(4)} → p = ${fmtPct(p10)}</span>`;
    }

    function resetAll(){
      document.getElementById("age").value = 30;
      document.getElementById("tonnis").value = "0";
      document.getElementById("height").value = 170;
      document.getElementById("weight").value = 60;
      document.getElementById("bmi").value = "—";
      document.getElementById("ai13").value = "0";
      updateObesityPill();

      document.getElementById("p5").textContent = "—";
      document.getElementById("p10").textContent = "—";

      const tag5 = document.getElementById("tag5");
      tag5.className = "tag";
      tag5.textContent = "Not calculated";

      const tag10 = document.getElementById("tag10");
      tag10.className = "tag";
      tag10.textContent = "Not calculated";

      document.getElementById("d5").innerHTML =
        `Model (5y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βAI13·(AI≥13)</span>`;

      document.getElementById("d10").innerHTML =
        `Model (10y): <span class="mono">logit(p) = β0 + βAge·Age + βTönnis·Tönnis + βObesity·(BMI≥30)</span>`;
    }

    // wire up (mobile-safe)
    (function(){
      const btnCalc = document.getElementById("btnCalc");
      const btnReset = document.getElementById("btnReset");
      const height = document.getElementById("height");
      const weight = document.getElementById("weight");

      ["input","change"].forEach(evt=>{
        height.addEventListener(evt, updateObesityPill);
        weight.addEventListener(evt, updateObesityPill);
      });

      function runCalc(e){
        if (e) e.preventDefault();
        calculate();
      }

      // Click + mobile taps
      btnCalc.addEventListener("click", runCalc);
      btnCalc.addEventListener("pointerup", runCalc);
      btnCalc.addEventListener("touchend", runCalc, { passive: false });

      btnReset.addEventListener("click", (e) => { e.preventDefault(); resetAll(); });
      btnReset.addEventListener("pointerup", (e) => { e.preventDefault(); resetAll(); });

      // Optional: Enter triggers calc
      document.getElementById("age").addEventListener("keydown", (e)=>{
        if (e.key === "Enter") { e.preventDefault(); calculate(); }
      });

      // init
      updateObesityPill();
    })();
  </script>
</body>
</html>
